The virtual machine takes bytecode generated by the front-end as instructions. It can then perform operations on one or more tables or indexes, each of which is stored in a data structure called a B-tree. The VM is essentially a big switch statement on the type of bytecode instruction.

Each B-tree consists of many nodes. Each node is one page in length. The B-tree can retrieve a page from disk or save it back to disk by issuing commands to the pager.

The pager receives commands to read or write pages of data. It is responsible for reading/writing at appropriate offsets in the database file. It also keeps a cache of recently-accessed pages in memory, and determines when those pages need to be written back to disk.

The os interface is the layer that differs depending on which operating system sqlite was compiled for. In this tutorial, I’m not going to support multiple platforms.


## Getline
`ssize_t getline(char **lineptr, size_t *n, FILE *stream);

- lineptr : a pointer to the variable we use to point to the buffer containing the read line. If it set to NULL it is mallocatted by getline and should thus be freed by the user, even if the command fails.
- n : a pointer to the variable we use to save the size of allocated buffer.
- stream : the input stream to read from. We’ll be reading from standard input.
- return value : the number of bytes read, which may be less than the size of the buffer


Non-SQL statements like .exit are called “meta-commands”. They all start with a dot, so we check for them and handle them in a separate function.

column	    type
id	        integer
username	varchar(32)
email	    varchar(255)

## insert 
insert 1 cstack foo@bar.com




column	size (bytes)	offset
id	        4	0
username	32	4
email	255	36
total	291



page   = n / ROWS_PER_PAGE
offset = n % ROWS_PER_PAGE

Avec n = 40 et ROWS_PER_PAGE = 40
page   = 40 / 40 = 1
offset = 40 % 40 = 0

Interprétation
page 1 : oui
offset 0 : première ligne de cette page

## L’offset = l’index de la ligne à l’intérieur de la page.

- row_slot: It maps a logical row number to a physical address
(page_id, byte_offset) → memory pointer


